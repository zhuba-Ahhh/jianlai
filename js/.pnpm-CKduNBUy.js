var t={exports:{}},e={};
/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
var i=React,s=Symbol.for("react.element"),r=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,a=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function l(t,e,i){var r,l={},h=null,u=null;for(r in void 0!==i&&(h=""+i),void 0!==e.key&&(h=""+e.key),void 0!==e.ref&&(u=e.ref),e)n.call(e,r)&&!o.hasOwnProperty(r)&&(l[r]=e[r]);if(t&&t.defaultProps)for(r in e=t.defaultProps)void 0===l[r]&&(l[r]=e[r]);return{$$typeof:s,type:t,key:h,ref:u,props:l,_owner:a.current}}e.Fragment=r,e.jsx=l,e.jsxs=l,t.exports=e;var h=t.exports;const u=(t=6,e="u_")=>{const i="abcdefhijkmnprstwxyz0123456789";let s="";for(let r=0;r<t;r++)s+=i.charAt(Math.floor(30*Math.random()));return e+s};var c=Object.defineProperty,d=(t,e,i)=>((t,e,i)=>e in t?c(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i);function p(t,e){if(t.size!==e.size)return!1;for(let[i,s]of t)if(!e.has(i)||e.get(i)!==s)return!1;return!0}let _=0;var g=Object.defineProperty,v=(t,e,i)=>((t,e,i)=>e in t?g(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i)(t,"symbol"!=typeof e?e+"":e,i);class m{constructor(t){v(this,"x"),v(this,"y"),v(this,"target"),this.x=t.x,this.y=t.y,this.target=t.target}}class w extends m{}class f extends m{}class y extends m{}class V extends m{}class b{constructor(t){v(this,"pluginId"),v(this,"pluginName"),v(this,"viewName"),v(this,"dataName"),v(this,"dataValue"),this.event=t,this.pluginId=t.pluginId,this.pluginName=t.pluginName,this.viewName=t.viewName,this.dataName=t.dataName,this.dataValue=t.dataValue}}function P(t){return t.split("").map(((t,e)=>t.toUpperCase()===t?`${0!==e?"-":""}${t.toLowerCase()}`:t)).join("")}class E{constructor(t){v(this,"node"),this.node=t.node}}class R{constructor(t){v(this,"node"),this.node=t.node}}class x{constructor(t){v(this,"_eventBus"),v(this,"_observer"),this._eventBus=t,this._observer=new MutationObserver(this._handler.bind(this)),this._observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0,attributeOldValue:!0})}_handler(t){t.forEach((t=>{t.addedNodes.forEach((t=>{if(!(t instanceof HTMLElement)||t.dataset.velViewId||t.parentElement&&typeof t.parentElement.dataset.velAdded<"u")return;let e=t;if(t.dataset.velView||(e=t.querySelector("[data-vel-view][data-vel-plugin]")),!e)return;this._eventBus.emitEvent(E,{node:e});const i=e.querySelectorAll("[data-vel-plugin]");i.length&&i.forEach((t=>{this._eventBus.emitEvent(E,{node:t})}))})),t.removedNodes.forEach((t=>{if(!(t instanceof HTMLElement)||typeof t.dataset.velProcessing<"u")return;const e=t.querySelectorAll("[data-vel-plugin]");e.length&&e.forEach((t=>{this._eventBus.emitEvent(R,{node:t})})),this._eventBus.emitEvent(R,{node:t})}));const e=t.attributeName;if("data-vel-view"===e&&this._eventBus.emitEvent(E,{node:t.target}),e&&/data-vel-data-.+/gi.test(e)){const i=t.target,s=i.dataset.velPluginId||"",r=i.dataset.velPlugin||"",n=i.dataset.velView||"",a=i.getAttribute(e);if(a&&a!==t.oldValue){const t=e.replace("data-vel-data-","").replace(/(?:^\w|[A-Z]|\b\w)/g,(function(t,e){return 0===e?t.toLowerCase():t.toUpperCase()})).replace(/\s+/g,"").replace(/-+/g,"");this._eventBus.emitEvent(b,{pluginId:s,pluginName:r,viewName:n,dataName:t,dataValue:a})}}}))}}class A{execute(t){this.call(t)}}class T extends A{constructor(t){super(),v(this,"_handler"),this._handler=t}getHandler(){return this._handler}call(t){this._handler(t)}}class C{constructor(){v(this,"_listeners",new Map),v(this,"_keyedListeners",new Map)}subscribeToEvent(t,e,i){if(i)return void this._subscribeToKeyedEvent(t,e,i);let s=this._listeners.get(t);s||(s=[],this._listeners.set(t,s)),s.push(new T(e))}removeEventListener(t,e,i){if(i)return void this._removeKeyedEventListener(t,e,i);let s=this._listeners.get(t);s&&(s=s.filter((t=>t.getHandler()!==e)),this._listeners.set(t,s))}_subscribeToKeyedEvent(t,e,i){let s=this._keyedListeners.get(t);s||(s=new Map,this._keyedListeners.set(t,s));let r=s.get(i);r||(r=[],s.set(i,r)),r.push(new T(e))}_removeKeyedEventListener(t,e,i){let s=this._keyedListeners.get(t);if(!s)return;let r=s.get(i);r&&(r=r.filter((t=>t.getHandler()!==e)),s.set(i,r))}emitEvent(t,e,i){if(i)return void this._emitKeyedEvent(t,e,i);const s=this._listeners.get(t);s&&s.forEach((t=>{t.execute(e)}))}_emitKeyedEvent(t,e,i){const s=this._keyedListeners.get(t);if(!s)return;const r=s.get(i);r&&r.forEach((t=>{t.execute(e)}))}_convertListener(t){return e=>t(e)}subscribeToPluginReadyEvent(t,e,i=!1){i?this.subscribeToEvent(Bt,this._convertListener(t),e):this.subscribeToEvent(Mt,this._convertListener(t),e)}emitPluginReadyEvent(t,e,i=!1){i?this.emitEvent(Bt,e,t):this.emitEvent(Mt,e,t)}reset(){this._listeners.clear()}}let L=0;function I(){return L+++""}class S{constructor(t,e,i,s,r,n,a){v(this,"_registry"),v(this,"_eventBus"),v(this,"_appEventBus"),v(this,"_internalEventBus"),v(this,"_initialized",!1),v(this,"_config"),v(this,"_pluginFactory"),v(this,"_pluginName"),v(this,"_id"),v(this,"_pluginKey"),v(this,"_layoutIdViewMapWaitingToEnter"),v(this,"_apiData"),v(this,"_isReady",!1),this._id=I(),this._pluginFactory=t,this._pluginName=e,this._registry=i,this._eventBus=s,this._appEventBus=r,this._internalEventBus=new C,this._config=n,this._layoutIdViewMapWaitingToEnter=new Map,this._pluginKey=a,this._apiData={},this._appEventBus.subscribeToPluginReadyEvent((()=>{this._isReady=!0}),this._pluginName,!0)}get api(){return this._apiData}_setApi(t){this._apiData=t}get pluginName(){return this._pluginName}get pluginFactory(){return this._pluginFactory}get pluginKey(){return this._pluginKey}get id(){return this._id}get config(){return{...this._config}}getViews(t){return t?this._registry.getViewsByNameForPlugin(this,t):this._registry.getViewsForPlugin(this)}getView(t){return t?this._registry.getViewsByNameForPlugin(this,t)[0]:this._registry.getViewsForPlugin(this)[0]}getViewById(t){return this._registry.getViewById(t)}addView(t){this._registry.assignViewToPlugin(t,this)}setInternalEventBus(t){this._internalEventBus=t}get internalBusEvent(){return this._internalEventBus}emit(t,e){this._internalEventBus.emitEvent(t,e,this.pluginKey)}on(t,e){this._internalEventBus.subscribeToEvent(t,e,this.pluginKey)}removeListener(t,e){this._internalEventBus.removeEventListener(t,e)}useEventPlugin(t,e={}){const i=this._registry.createPlugin(t,this._eventBus,e);return this._registry.associateEventPluginWithPlugin(this.id,i.id),i}notifyAboutDataChanged(t){this.onDataChanged(t)}onDataChanged(t){}removeView(t){t.onRemoveCallback?this._invokeRemoveCallback(t):this._deleteView(t),this.onViewRemoved(t)}_invokeRemoveCallback(t){const e=this._createTemporaryView(t);requestAnimationFrame((()=>{var i;null==(i=e.onRemoveCallback)||i.call(e,e,(()=>{var i,s;if(null!=(i=t.onAddCallbacks)&&i.afterRemoved&&t.layoutId){const e=this._layoutIdViewMapWaitingToEnter.get(t.layoutId);null==(s=null==e?void 0:e.onAddCallbacks)||s.afterEnter(e),this._layoutIdViewMapWaitingToEnter.delete(t.layoutId)}this._deleteView(e,!0)})),setTimeout((()=>{e.element.parentElement&&this._deleteView(e,!0)}),1e4)}))}_deleteView(t,e=!1){(e||!t.layoutId)&&(this._registry.removeViewById(t.id,this.id),t.element.remove())}_createTemporaryView(t){const e=t.previousRect.viewportOffset,i=t.previousRect.size,s=t.rotation.degrees<0?0:Math.sin(t.rotation.radians)*i.height*t.scale.y,r=t.rotation.degrees>0?0:Math.sin(t.rotation.radians)*i.width*t.scale.y,n=t.element.cloneNode(!0);t.element.remove(),n.style.cssText="",n.style.position="absolute",n.style.left=`${e.left+s}px`,n.style.top=e.top-r+"px",n.style.width=`${i.width}px`,n.style.height=`${i.height}px`,n.style.transform=`\n      scale3d(${t.scale.x}, ${t.scale.y}, 1) rotate(${t.rotation.degrees}deg)\n    `,n.style.pointerEvents="none",n.dataset.velRemoved="",document.body.appendChild(n);const a=this._registry.createView(n,t.name);return a.setAsTemporaryView(),a.styles.position="absolute",a.styles.left=`${e.left+s}px`,a.styles.top=e.top-r+"px",a.rotation.setDegrees(t.rotation.degrees,!1),a.scale.set({x:t.scale.x,y:t.scale.y},!1),a.size.set({width:t._localWidth,height:t._localHeight},!1),t._copyAnimatorsToAnotherView(a),t.onRemoveCallback&&a.onRemove(t.onRemoveCallback),a}onViewRemoved(t){}notifyAboutViewAdded(t){this.onViewAdded(t),this._invokeAddCallbacks(t)}_invokeAddCallbacks(t){var e,i,s;(null==(e=t.onAddCallbacks)||!e.onInitialLoad)&&!this._initialized||(null==(i=t.onAddCallbacks)||i.beforeEnter(t),null!=(s=t.onAddCallbacks)&&s.afterRemoved&&this._initialized?t.layoutId&&this._layoutIdViewMapWaitingToEnter.set(t.layoutId,t):requestAnimationFrame((()=>{var e;null==(e=t.onAddCallbacks)||e.afterEnter(t)})))}onViewAdded(t){}init(){!this._initialized&&this._isReady&&(this.setup(),this._initialized=!0)}setup(){}subscribeToEvents(t){}}class N extends S{isRenderable(){return!0}isInitialized(){return this._initialized}get initialized(){return this._initialized}update(t,e){}render(){}addView(t){t.setPluginId(this.id),super.addView(t)}}class M extends S{isRenderable(){return!1}}class B{constructor(t){v(this,"_plugin"),this._plugin=t}get initialized(){return this._plugin.isInitialized()}get config(){return this._plugin.config}setup(t){this._plugin.setup=t}api(t){this._plugin._setApi(t)}update(t){this._plugin.update=t}render(t){this._plugin.render=t}getViews(t){return this._plugin.getViews(t)}getView(t){return this._plugin.getView(t)}getViewById(t){return this._plugin.getViewById(t)}useEventPlugin(t,e={}){return this._plugin.useEventPlugin(t,e)}emit(t,e){this._plugin.emit(t,e)}on(t,e){this._plugin.on(t,e)}onDataChanged(t){this._plugin.onDataChanged=t}onViewRemoved(t){this._plugin.onViewRemoved=t}onViewAdded(t){this._plugin.onViewAdded=t}subscribeToEvents(t){this._plugin.subscribeToEvents=t}}function F(t,e,i,s,r,n){if(function(t){var e;return 0===(null==(e=t.prototype)?void 0:e.constructor.toString().indexOf("class "))}(t))return new t(t,t.pluginName,e,i,s,r,n);const a=new N(t,t.pluginName,e,i,s,r,n);return t(new B(a)),a}class k{constructor(t,e){v(this,"x"),v(this,"y"),this.x=t,this.y=e}get magnitudeSquared(){return this.x*this.x+this.y*this.y}get magnitude(){return Math.sqrt(this.x*this.x+this.y*this.y)}get unitVector(){const t=new k(0,0),e=this.magnitude;return 0!==e&&(t.x=this.x/e,t.y=this.y/e),t}add(t){this.x+=t.x,this.y+=t.y}sub(t){this.x-=t.x,this.y-=t.y}scale(t){this.x*=t,this.y*=t}dot(t){return this.x*t.x+this.y*t.y}equals(t){return this.x===t.x&&this.y===t.y}clone(){return new k(this.x,this.y)}static scale(t,e){return new k(t.x*e,t.y*e)}static sub(t,e){return new k(t.x-e.x,t.y-e.y)}static add(t,e){return new k(t.x+e.x,t.y+e.y)}}class O{constructor(t){v(this,"_element"),v(this,"_callback"),this._element=t,this._observe()}setElement(t){this._element=t,this._observe()}_observe(){var t;function e(t,e){let i,s=!0;return function(){s&&(t(),s=!1),clearTimeout(i),i=setTimeout((()=>{t(),s=!0}),e)}}new MutationObserver((()=>{var t;null==(t=this._callback)||t.call(this,!1)})).observe(this._element,{attributes:!0,childList:!0,attributeOldValue:!0}),new ResizeObserver((()=>{var t;null==(t=this._callback)||t.call(this,!0)})).observe(this._element),null==(t=this._element.parentElement)||t.addEventListener("scroll",e((()=>{var t;null==(t=this._callback)||t.call(this,!0)}),30)),window.addEventListener("scroll",e((()=>{var t;null==(t=this._callback)||t.call(this,!0)}),30)),window.addEventListener("resize",e((()=>{var t;null==(t=this._callback)||t.call(this,!0)}),30))}onChange(t){this._callback=t}}function $(t,e){const i=t-e;return Math.abs(i)<=.01}function z(t){let e=t.match(/^([\d.]+)([a-zA-Z%]*)$/);e||(e="0px".match(/^([\d.]+)([a-zA-Z%]*)$/));return{value:parseFloat(e[1]),unit:e[2],valueWithUnit:t}}function D(t,e){return function(t,e,i=!1){if(t===e)return!0;if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++)if(i&&!$(t[s].value,e[s].value)||t[s].value!==e[s].value)return!1;return!0}(t,e,!0)}class W{constructor(t,e,i,s){v(this,"_topLeft"),v(this,"_topRight"),v(this,"_bottomLeft"),v(this,"_bottomRight"),this._topLeft=t,this._topRight=e,this._bottomLeft=i,this._bottomRight=s}get value(){return{topLeft:this._topLeft,topRight:this._topRight,bottomRight:this._bottomRight,bottomLeft:this._bottomLeft}}equals(t){return $(this.value.topLeft.value,t.value.topLeft.value)&&$(this.value.topRight.value,t.value.topRight.value)&&$(this.value.bottomRight.value,t.value.bottomRight.value)&&$(this.value.bottomLeft.value,t.value.bottomLeft.value)}toCssPercentageForNewSize(t){const e=this._convertToPercentage(this._topLeft,t),i=this._convertToPercentage(this._topRight,t),s=this._convertToPercentage(this._bottomLeft,t),r=this._convertToPercentage(this._bottomRight,t);return`${e.h} ${i.h} ${r.h} ${s.h} / ${e.v} ${i.v} ${r.v} ${s.v}`}_convertToPercentage(t,e){if("%"===t.unit)return{h:`${t.value}%`,v:`${t.value}%`};return{h:`${t.value/e.width*100}%`,v:`${t.value/e.height*100}%`}}}function q(t){const e=t.split(" ").map((t=>z(t))),i={value:0,unit:"",valueWithUnit:"0"};switch(e.length){case 1:return new W(e[0],e[0],e[0],e[0]);case 2:return new W(e[0],e[1],e[0],e[1]);case 3:return new W(e[0],e[1],e[2],e[1]);case 4:return new W(e[0],e[1],e[3],e[2]);default:return new W(i,i,i,i)}}function U(t,e){return $(t.topLeft.value,e.topLeft.value)&&$(t.topRight.value,e.topRight.value)&&$(t.bottomRight.value,e.bottomRight.value)&&$(t.bottomLeft.value,e.bottomLeft.value)}class j{constructor(t){v(this,"_value"),this._value=t}get value(){return this._value}equals(t){return $(this.value,t.value)}}class Y{constructor(t,e){v(this,"_x"),v(this,"_y"),this._x=t,this._y=e}get value(){return new k(this._x,this._y)}}function H(t,e){const i=function(t){const e=t.getBoundingClientRect();return{left:e.left,top:e.top,right:e.right,bottom:e.bottom,width:e.width,height:e.height}}(t),s=t.offsetWidth,r=t.offsetHeight;return{viewportOffset:{left:Math.round(i.left),top:Math.round(i.top),right:Math.round(i.right),bottom:Math.round(i.bottom)},pageOffset:e.read({width:s,height:r}),size:{width:s,height:r}}}function X(t){let e=t,i=0,s=0;for(;e;)i+=e.offsetTop,s+=e.offsetLeft,e=e.offsetParent;return{top:i,left:s}}class K{constructor(t){v(this,"_currentPageRect"),v(this,"_view"),v(this,"_element"),v(this,"_offsetLeft"),v(this,"_offsetTop"),v(this,"_width"),v(this,"_height"),v(this,"_parentWidth"),v(this,"_parentHeight"),v(this,"_parentEl"),v(this,"_isSvg"),v(this,"_invalid"),this._invalid=!0,this._view=t,this._element=t.element,this._isSvg=!!this._element.closest("svg"),this._offsetLeft=0,this._offsetTop=0,this._width=0,this._height=0,this._parentWidth=0,this._parentHeight=0,this._offsetLeft=0,this._parentEl=this._element.parentElement,window.addEventListener("resize",(()=>{this.invalidate()}))}invalidate(){this._invalid=!0}read(t){if(this._isSvg)return this._currentPageRect||(this._currentPageRect=X(this._element)),this._currentPageRect;const e=this._element.parentElement,i=this._element.offsetLeft,s=this._element.offsetTop,r=t.width,n=t.height,a=(null==e?void 0:e.offsetWidth)||0,o=(null==e?void 0:e.offsetHeight)||0;return(this._offsetLeft!==i||this._offsetTop!==s||!$(this._width,r)||!$(this._height,n))&&this._view._children.forEach((t=>t.elementReader.invalidatePageRect())),!this._invalid&&this._currentPageRect&&this._offsetLeft===i&&this._offsetTop===s&&$(this._width,r)&&$(this._height,n)&&$(this._parentWidth,a)&&$(this._parentHeight,o)&&this._parentEl===e||(this._offsetLeft=i,this._offsetTop=s,this._width=r,this._height=n,this._parentWidth=a,this._parentHeight=o,this._parentEl=e,this._currentPageRect=X(this._element),this._invalid=!1),this._currentPageRect}}class Z{constructor(t){v(this,"_element"),v(this,"_rect"),v(this,"_computedStyle"),v(this,"_pageRectReader"),v(this,"_scroll"),this._element=t.element,this._pageRectReader=new K(t),this._rect=H(this._element,this._pageRectReader),this._computedStyle=getComputedStyle(this._element),this._scroll=this._calculateScroll()}invalidatePageRect(){this._pageRectReader.invalidate()}update(t=!1){this._rect=H(this._element,this._pageRectReader),this._computedStyle=getComputedStyle(this._element),t&&(this._scroll=this._calculateScroll())}get rect(){return this._rect}get opacity(){return t=this._computedStyle.opacity,new j(parseFloat(t));var t}get borderRadius(){return q(this._computedStyle.borderRadius)}get origin(){return function(t,e){const[i,s]=t.split(" "),r=z(i),n=z(s);return new Y(r.value/e.width,n.value/e.height)}(this._computedStyle.transformOrigin,this._rect.size)}_calculateScroll(){let t=this._element,e=0,i=0;for(;t;)e+=t.scrollTop,i+=t.scrollLeft,t=t.offsetParent;return i+=window.scrollX,e+=window.scrollY,{y:e,x:i}}get scroll(){return this._scroll}}function G(t){return new Z(t)}function J(t,e){return new Proxy(t,{set:(t,i,s)=>("object"==typeof t[i]&&null!==t[i]?t[i]=J(s,e):(e(),t[i]=s),!0),get:(t,i)=>"object"==typeof t[i]&&null!==t[i]?J(t[i],e):t[i]})}const Q=.01,tt={speed:15};class et{constructor(t){v(this,"name","dynamic"),v(this,"_config"),this._config=t}get config(){return this._config}}class it extends et{update({animatorProp:t,current:e,target:i,dt:s}){const r=k.sub(i,e),n=k.scale(r,this._config.speed);let a=k.add(e,k.scale(n,s));return this._shouldFinish(i,e,n)&&(a=i,requestAnimationFrame((()=>{t.callCompleteCallback()}))),t.callUpdateCallback(),a}_shouldFinish(t,e,i){return k.sub(t,e).magnitude<Q&&i.magnitude<Q}}class st extends et{update({animatorProp:t,current:e,target:i,dt:s}){let r=e+(i-e)*this._config.speed*s;return $(r,i)&&(r=i,requestAnimationFrame((()=>{t.callCompleteCallback()}))),t.callUpdateCallback(),r}}class rt extends et{update({animatorProp:t,current:e,target:i,dt:s}){return i.map(((i,r)=>{const n=e[r],a=0===i.value?n.unit:i.unit,o=(i.value-n.value)*this._config.speed;let l=z(`${n.value+o*s}${a}`);return this._shouldFinish(i.value,n.value,o)&&(l=i,requestAnimationFrame((()=>{t.callCompleteCallback()}))),t.callUpdateCallback(),l}))}_shouldFinish(t,e,i){return Math.abs(t-e)<Q&&Math.abs(i)<Q}}class nt{constructor(){v(this,"name","instant"),v(this,"_config",{})}get config(){return this._config}update(t){return requestAnimationFrame((()=>{t.animatorProp.callCompleteCallback()})),t.target}}const at={stiffness:.5,damping:.75,speed:10},ot=.01;class lt{constructor(t){v(this,"name","spring"),v(this,"_config"),this._config=t}get config(){return this._config}}class ht extends lt{constructor(){super(...arguments),v(this,"_velocity",new k(0,0))}update({animatorProp:t,current:e,target:i,dt:s}){const r=k.scale(k.scale(k.sub(e,i),-1),this._config.stiffness);this._velocity=k.add(this._velocity,r),this._velocity=k.scale(this._velocity,this._config.damping);let n=k.add(e,k.scale(this._velocity,s*this._config.speed));return this._shouldFinish(i,e)&&(n=i,requestAnimationFrame((()=>{t.callCompleteCallback()}))),n}_shouldFinish(t,e){return k.sub(t,e).magnitude<ot&&this._velocity.magnitude<ot}}class ut extends lt{constructor(){super(...arguments),v(this,"_velocity",0)}update({animatorProp:t,current:e,target:i,dt:s}){const r=-(e-i)*this._config.stiffness;this._velocity+=r,this._velocity*=this._config.damping;let n=e+this._velocity*s*this._config.speed;return $(n,i)&&(n=i,requestAnimationFrame((()=>{t.callCompleteCallback()}))),n}}class ct extends lt{constructor(){super(...arguments),v(this,"_velocity",0)}update({animatorProp:t,current:e,target:i,dt:s}){return i.map(((i,r)=>{const n=e[r],a=0===i.value?n.unit:i.unit,o=-(n.value-i.value)*this._config.stiffness;this._velocity+=o,this._velocity*=this._config.damping;let l=z(`${n.value+this._velocity*s*this._config.speed}${a}`);return this._shouldFinish(i.value,n.value)&&(l=i,requestAnimationFrame((()=>{t.callCompleteCallback()}))),l}))}_shouldFinish(t,e){return Math.abs(t-e)<ot&&Math.abs(this._velocity)<ot}}const dt={duration:350,ease:function(t){return t}};class pt{constructor(t){v(this,"name","tween"),v(this,"_config"),v(this,"_startTime"),this._config=t}get config(){return this._config}reset(){this._startTime=void 0}}class _t extends pt{update({animatorProp:t,initial:e,target:i,ts:s}){this._startTime||(this._startTime=s);const r=Math.min(1,(s-this._startTime)/this._config.duration);return $(r,1)?(requestAnimationFrame((()=>{t.callCompleteCallback()})),i):k.add(e,k.scale(k.sub(i,e),this._config.ease(r)))}}class gt extends pt{update({animatorProp:t,initial:e,target:i,ts:s}){this._startTime||(this._startTime=s);const r=Math.min(1,(s-this._startTime)/this._config.duration);return $(r,1)?(requestAnimationFrame((()=>{t.callCompleteCallback()})),i):e.map(((t,e)=>{const s=i[e],n=0===s.value?t.unit:s.unit;return z(`${t.value+this._config.ease(r)*(i[e].value-t.value)}${n}`)}))}}class vt extends pt{update({animatorProp:t,initial:e,target:i,ts:s}){this._startTime||(this._startTime=s);const r=Math.min(1,(s-this._startTime)/this._config.duration);return $(r,1)?(requestAnimationFrame((()=>{t.callCompleteCallback()})),i):e+(i-e)*this._config.ease(r)}}class mt{createAnimatorByName(t,e){switch(t){case"instant":return this.createInstantAnimator();case"dynamic":return this.createDynamicAnimator(e);case"tween":return this.createTweenAnimator(e);case"spring":return this.createSpringAnimator(e)}return this.createInstantAnimator()}}class wt extends mt{createInstantAnimator(){return new nt}createTweenAnimator(t){return new _t({...dt,...t})}createDynamicAnimator(t){return new it({...tt,...t})}createSpringAnimator(t){return new ht({...at,...t})}}class ft extends mt{createInstantAnimator(){return new nt}createTweenAnimator(t){return new gt({...dt,...t})}createDynamicAnimator(t){return new rt({...tt,...t})}createSpringAnimator(t){return new ct({...at,...t})}}class yt extends mt{createInstantAnimator(){return new nt}createDynamicAnimator(t){return new st({...tt,...t})}createTweenAnimator(t){return new vt({...dt,...t})}createSpringAnimator(t){return new ut({...at,...t})}}function Vt(t){return structuredClone(t)}class bt{constructor(t){v(this,"_viewProp"),v(this,"_completeCallback"),v(this,"_updateCallback"),v(this,"_isAnimating"),this._viewProp=t,this._isAnimating=!1}set(t,e){this._viewProp.setAnimator(t,e)}get name(){return this._viewProp.getAnimator().name}onComplete(t){this._completeCallback=t}get isAnimating(){return this._isAnimating}markAsAnimating(){this._isAnimating=!0}callCompleteCallback(){var t;null==(t=this._completeCallback)||t.call(this),this._isAnimating=!1}onUpdate(t){this._updateCallback=t}callUpdateCallback(){var t;null==(t=this._updateCallback)||t.call(this)}}class Pt{constructor(t,e,i){v(this,"_animatorProp"),v(this,"_animator"),v(this,"_initialValue"),v(this,"_previousValue"),v(this,"_targetValue"),v(this,"_currentValue"),v(this,"_hasChanged"),v(this,"_view"),v(this,"_animatorFactory"),v(this,"_previousRenderValue"),this._animatorProp=new bt(this),this._animatorFactory=t,this._initialValue=Vt(e),this._previousValue=Vt(e),this._targetValue=Vt(e),this._currentValue=Vt(e),this._hasChanged=!1,this._previousRenderValue=void 0,this._view=i,this._animator=this._animatorFactory.createInstantAnimator()}get shouldRender(){return!0}get isAnimating(){return this.animator.isAnimating}getAnimator(){return this._animator}get animator(){return this._animatorProp}get _rect(){return this._view.rect}get _previousRect(){return this._view.previousRect}setAnimator(t,e){this._animator=this._animatorFactory.createAnimatorByName(t,e)}_setTarget(t,e=!0){var i,s;this._previousValue=Vt(this._currentValue),this._targetValue=t,e?(null==(s=(i=this._animator).reset)||s.call(i),this.animator.markAsAnimating()):this._currentValue=t,this._hasChanged=!0}hasChanged(){return this._hasChanged}destroy(){this._hasChanged=!1}update(t,e){}}class Et extends Pt{constructor(){super(...arguments),v(this,"_invertedBorderRadius"),v(this,"_forceStyleUpdateThisFrame",!1),v(this,"_updateWithScale",!1)}setFromElementPropValue(t){this._setTarget([t.value.topLeft,t.value.topRight,t.value.bottomRight,t.value.bottomLeft],!0)}enableUpdateWithScale(){this._updateWithScale=!0}disableUpdateWithScale(){this._updateWithScale=!1}get value(){return{topLeft:this._currentValue[0],topRight:this._currentValue[1],bottomRight:this._currentValue[2],bottomLeft:this._currentValue[3]}}get invertedBorderRadius(){return this._invertedBorderRadius}set(t,e=!0){let i;if("string"==typeof t){const e=q(t.trim());i={topLeft:e.value.topLeft.valueWithUnit,topRight:e.value.topRight.valueWithUnit,bottomRight:e.value.bottomRight.valueWithUnit,bottomLeft:e.value.bottomLeft.valueWithUnit}}else i=t;const s=i.topLeft?z(i.topLeft):this._currentValue[0],r=i.topRight?z(i.topRight):this._currentValue[1],n=i.bottomRight?z(i.bottomRight):this._currentValue[2],a=i.bottomLeft?z(i.bottomLeft):this._currentValue[3];this._setTarget([s,r,n,a],e)}reset(t=!0){this._setTarget(this._initialValue,t)}update(t,e){if(this._forceStyleUpdateThisFrame)this._hasChanged=!0,this._forceStyleUpdateThisFrame=!1;else if(this._view.scale.isAnimating&&this._updateWithScale)this._hasChanged=!0;else if(D(this._targetValue,this._currentValue))return void(this._hasChanged=!D(this._targetValue,this._initialValue));this._currentValue=this._animator.update({animatorProp:this._animatorProp,current:this._currentValue,target:this._targetValue,initial:this._previousValue,ts:t,dt:e}),this._updateWithScale&&this._applyScaleInverse()}applyScaleInverse(){this._updateWithScale&&(this._forceStyleUpdateThisFrame=!0)}_applyScaleInverse(){if($(this._view.scale.x,1)&&$(this._view.scale.y,1))return;const t=this._rect.size.width*this._view.scale.x,e=this._rect.size.height*this._view.scale.y;this._invertedBorderRadius=function(t,e){const i=a(t.topLeft,e),s=a(t.topRight,e),r=a(t.bottomLeft,e),n=a(t.bottomRight,e);return{v:{topLeft:i.v,topRight:s.v,bottomRight:n.v,bottomLeft:r.v},h:{topLeft:i.h,topRight:s.h,bottomRight:n.h,bottomLeft:r.h}};function a(t,e){if("%"===t.unit)return{h:z(`${t.value}%`),v:z(`${t.value}%`)};const i=t.value/e.width*100,s=t.value/e.height*100;return{h:z(`${i}%`),v:z(`${s}%`)}}}(q(`${this._currentValue[0].valueWithUnit} ${this._currentValue[1].valueWithUnit} ${this._currentValue[2].valueWithUnit} ${this._currentValue[3].valueWithUnit}`).value,{width:t,height:e})}get shouldRender(){return!!this._hasChanged&&(!this._previousRenderValue||!(U(this.renderValue.v,this._previousRenderValue.v)&&U(this.renderValue.h,this._previousRenderValue.h)))}get renderValue(){return this.invertedBorderRadius?{v:{topLeft:this.invertedBorderRadius.v.topLeft,topRight:this.invertedBorderRadius.v.topRight,bottomLeft:this.invertedBorderRadius.v.bottomLeft,bottomRight:this.invertedBorderRadius.v.bottomRight},h:{topLeft:this.invertedBorderRadius.h.topLeft,topRight:this.invertedBorderRadius.h.topRight,bottomLeft:this.invertedBorderRadius.h.bottomLeft,bottomRight:this.invertedBorderRadius.h.bottomRight}}:{v:{topLeft:this.value.topLeft,topRight:this.value.topRight,bottomLeft:this.value.bottomLeft,bottomRight:this.value.bottomRight},h:{topLeft:this.value.topLeft,topRight:this.value.topRight,bottomLeft:this.value.bottomLeft,bottomRight:this.value.bottomRight}}}projectStyles(){const t=this.renderValue,e=`border-radius: ${t.h.topLeft.valueWithUnit} ${t.h.topRight.valueWithUnit} ${t.h.bottomRight.valueWithUnit} ${t.h.bottomLeft.valueWithUnit} / ${t.v.topLeft.valueWithUnit} ${t.v.topRight.valueWithUnit} ${t.v.bottomRight.valueWithUnit} ${t.v.bottomLeft.valueWithUnit};`;return this._previousRenderValue=t,e}isTransform(){return!1}}class Rt extends Pt{setFromElementPropValue(t){this._setTarget(t.value,!0)}get value(){return this._currentValue}set(t,e=!0){this._setTarget(t,e)}reset(t=!0){this._setTarget(1,t)}update(t,e){$(this._targetValue,this._currentValue)?this._hasChanged=!$(this._targetValue,this._initialValue):this._currentValue=this._animator.update({animatorProp:this._animatorProp,current:this._currentValue,target:this._targetValue,initial:this._previousValue,ts:t,dt:e})}get shouldRender(){return!!this._hasChanged&&(typeof this._previousRenderValue>"u"||this.renderValue!==this._previousRenderValue)}get renderValue(){return this.value}projectStyles(){const t=this.renderValue,e=`opacity: ${t};`;return this._previousRenderValue=t,e}isTransform(){return!1}}class xt extends Pt{get x(){return this._currentValue.x}get y(){return this._currentValue.y}set(t){const e={x:this.x,y:this.y,...t};e.x<0||e.x>1||e.y<0||e.y>1||this._setTarget(new k(e.x,e.y),!1)}reset(){this._setTarget(this._initialValue,!1)}get shouldRender(){if(!this._hasChanged)return!1;if(!this._previousRenderValue)return!0;const t=this.renderValue;return!($(t.x,this._previousRenderValue.x)&&$(t.y,this._previousRenderValue.y))}get renderValue(){return new k(100*this.x,100*this.y)}projectStyles(){const t=this.renderValue,e=`transform-origin: ${t.x}% ${t.y}%;`;return this._previousRenderValue=t,e}isTransform(){return!1}}class At extends Pt{constructor(){super(...arguments),v(this,"_animateLayoutUpdateNextFrame",!1),v(this,"_parentScaleInverse",new k(1,1))}get _parentDiff(){let t=this._view._parent,e=0,i=0;if(t){const s=t.rect.pageOffset,r=t.getScroll(),n={left:t.previousRect.viewportOffset.left+r.x,top:t.previousRect.viewportOffset.top+r.y};e=n.left-s.left,i=n.top-s.top}return{parentDx:e,parentDy:i}}get x(){return this._currentValue.x+this._rect.pageOffset.left+this._parentDiff.parentDx}get y(){return this._currentValue.y+this._rect.pageOffset.top+this._parentDiff.parentDy}get initialX(){return this._rect.pageOffset.left}get initialY(){return this._rect.pageOffset.top}progressTo(t){const e=typeof t.x>"u"?this.initialX:t.x,i=typeof t.y>"u"?this.initialY:t.y,s=new k(e,i),r=new k(this.initialX,this.initialY),n=new k(this.x,this.y),a=k.sub(n,r),o=k.sub(s,r);return 1-k.sub(o,a).magnitude/o.magnitude}set(t,e=!0){const i={x:this.x,y:this.y,...t};this._setTarget(new k(i.x-this._rect.pageOffset.left,i.y-this._rect.pageOffset.top),e)}reset(t=!0){this._setTarget(new k(0,0),t)}update(t,e){if((this._view.isInverseEffectEnabled||this._view.isLayoutTransitionEnabled)&&!this._view.isTemporaryView&&this._runLayoutTransition(),this._view.isInverseEffectEnabled){const t=this._view._parent,e=t?t.scale.x:1,i=t?t.scale.y:1;this._parentScaleInverse=new k(1/e,1/i),this._parentScaleInverse.equals(new k(1,1))||(this._hasChanged=!0)}if(this._targetValue.x===this._currentValue.x&&this._targetValue.y===this._currentValue.y)return;const i=this._view._parent,s=i?i.scale.x:1,r=i?i.scale.y:1,n=i?i.scale._previousValue.x:1,a=i?i.scale._previousValue.y:1;this._currentValue=this._animator.update({animatorProp:this._animatorProp,current:new k(this._currentValue.x*s,this._currentValue.y*r),target:this._targetValue,initial:new k(this._previousValue.x*n,this._previousValue.y*a),ts:t,dt:e}),this._currentValue=new k(this._currentValue.x/s,this._currentValue.y/r)}_runLayoutTransition(){const t=!(this._targetValue.x===this._currentValue.x&&this._targetValue.y===this._currentValue.y),e=!(this._view.scale._targetValue.x===this._view.scale._currentValue.x&&this._view.scale._targetValue.y===this._view.scale._currentValue.y),i=t||e,s=this._rect.pageOffset.left-this._previousRect.pageOffset.left,r=this._rect.pageOffset.top-this._previousRect.pageOffset.top,n=this._previousRect.size.width/this._rect.size.width,a=this._previousRect.size.height/this._rect.size.height;let o=!1;if(o=0!==s||0!==r||!Number.isNaN(n)&&1!==n||!Number.isNaN(a)&&1!==a||(()=>{const t=this._view._parents;for(let e=0;e<t.length;e++){const i=t[e],s=i.previousRect.size.width/i.rect.size.width,r=i.previousRect.size.height/i.rect.size.height;if(1!==s||1!==r)return!0}return!1})(),o){if(0!==this._currentValue.x||0!==this._currentValue.y||1!==this._view.scale._currentValue.x||1!==this._view.scale._currentValue.y){if(!i){const t=this._rect.pageOffset.left-this._previousRect.pageOffset.left,e=this._rect.pageOffset.top-this._previousRect.pageOffset.top;return void this._setTarget(new k(this._currentValue.x-t,this._currentValue.y-e),!1)}const t=this._view._parent,e=this._rect.pageOffset,s=this._view.getScroll(),r={left:this._previousRect.viewportOffset.left+s.x,top:this._previousRect.viewportOffset.top+s.y},n=r.left-e.left,a=r.top-e.top;let o=0,l=0,h=0,u=0;if(t){const e=t.rect.pageOffset,i=t.getScroll(),s={left:t.previousRect.viewportOffset.left+i.x,top:t.previousRect.viewportOffset.top+i.y};o=s.left-e.left,l=s.top-e.top;const n=r.top-s.top,a=r.left-s.left;h=(n-t.scale.y*n)/t.scale.y;u=(a-t.scale.x*a)/t.scale.x}return this._setTarget(new k(n-o+u,a-l+h),!1),void(i&&(this._animateLayoutUpdateNextFrame=!0))}this._animateLayoutUpdateNextFrame=!0;const t=this._previousRect,e=this._rect,s=this._view._parent;let r=0,n=0;s&&(r=s.previousRect.viewportOffset.left-s.rect.viewportOffset.left),s&&(n=s.previousRect.viewportOffset.top-s.rect.viewportOffset.top);let a=1,o=1;s&&(a=s.previousRect.size.width/s.rect.size.width,o=s.previousRect.size.height/s.rect.size.height);const l=s?s.previousRect.viewportOffset.left:0,h=s?s.previousRect.viewportOffset.top:0,u=t.viewportOffset.left-l,c=t.viewportOffset.top-h,d=u/a-u,p=c/o-c;let _=t.viewportOffset.left-e.viewportOffset.left-r+d,g=t.viewportOffset.top-e.viewportOffset.top-n+p;_=Number.isFinite(_)?_:0,g=Number.isFinite(g)?g:0,this._setTarget(new k(_,g),!1)}else this._animateLayoutUpdateNextFrame&&(this._setTarget(this._initialValue,!0),this._animateLayoutUpdateNextFrame=!1)}get shouldRender(){if(!this._hasChanged)return!1;if(!this._previousRenderValue)return!0;const t=this.renderValue;return!($(t.x,this._previousRenderValue.x)&&$(t.y,this._previousRenderValue.y))}get renderValue(){let t=0,e=0;return(this._view.isInverseEffectEnabled||this._view.isLayoutTransitionEnabled)&&(t=(this._rect.size.width*this._parentScaleInverse.x*this._view.scale.x-this._rect.size.width)*this._view.origin.x,e=(this._rect.size.height*this._parentScaleInverse.y*this._view.scale.y-this._rect.size.height)*this._view.origin.y),new k(this._currentValue.x+t,this._currentValue.y+e)}projectStyles(){const t=this.renderValue,e=`translate3d(${t.x}px, ${t.y}px, 0px)`;return this._previousRenderValue=t,e}isTransform(){return!0}}class Tt extends Pt{constructor(){super(...arguments),v(this,"_unit","deg")}get degrees(){let t=this._currentValue;return"rad"===this._unit&&(t*=180/Math.PI),t}get radians(){let t=this._currentValue;return"deg"===this._unit&&(t*=Math.PI/180),t}setDegrees(t,e=!0){this._unit="deg",this._setTarget(t,e)}setRadians(t,e=!0){this._unit="rad",this._setTarget(t,e)}reset(t=!0){this._setTarget(0,t)}update(t,e){this._targetValue!==this._currentValue&&(this._currentValue=this._animator.update({animatorProp:this._animatorProp,current:this._currentValue,target:this._targetValue,initial:this._previousValue,ts:t,dt:e}))}get shouldRender(){if(!this._hasChanged)return!1;if(typeof this._previousRenderValue>"u")return!0;return!$(this.renderValue,this._previousRenderValue)}get renderValue(){return this._currentValue}projectStyles(){const t=this.renderValue,e=`rotate(${t}${this._unit})`;return this._previousRenderValue=t,e}isTransform(){return!0}}class Ct extends Pt{constructor(){super(...arguments),v(this,"_animateLayoutUpdateNextFrame",!1)}get x(){return this._currentValue.x}get y(){return this._currentValue.y}set(t,e=!0){const i={x:this._currentValue.x,y:this._currentValue.y,..."number"==typeof t?{x:t,y:t}:t};this._setTarget(new k(i.x,i.y),e)}setWithSize(t,e=!0){let i=this._currentValue.x,s=this._currentValue.y;t.width&&(i=t.width/this._rect.size.width),t.height&&(s=t.height/this._rect.size.height),!t.width&&t.height&&(i=s),!t.height&&t.width&&(s=i);const r={x:i,y:s};this._setTarget(new k(r.x,r.y),e)}reset(t=!0){this._setTarget(new k(1,1),t)}update(t,e){if("position"!==this._view.layoutOption){if((this._view.isInverseEffectEnabled||this._view.isLayoutTransitionEnabled)&&!this._view.isTemporaryView&&this._runLayoutTransition(),this._view.isInverseEffectEnabled){const t=this._view._parent,e=t?t.scale.x:1,i=t?t.scale.y:1;this._hasChanged=1!==e||1!==i}this._targetValue.x===this._currentValue.x&&this._targetValue.y===this._currentValue.y||(this._currentValue=this._animator.update({animatorProp:this._animatorProp,current:this._currentValue,target:this._targetValue,initial:new k(this._previousValue.x,this._previousValue.y),ts:t,dt:e}))}}_runLayoutTransition(){const t=!(this._targetValue.x===this._currentValue.x&&this._targetValue.y===this._currentValue.y),e=this._previousRect.size.width/this._rect.size.width,i=this._previousRect.size.height/this._rect.size.height;let s=!1;if((!Number.isNaN(e)&&1!==e||!Number.isNaN(i)&&1!==i)&&(s=!0),s){if(1!==this._currentValue.x||1!==this._currentValue.y){const e=this._view.previousRect.size.width/this._view.rect.size.width,i=this._view.previousRect.size.height/this._view.rect.size.height;return this._setTarget(new k(this._currentValue.x*e,this._currentValue.y*i),!1),void(t&&(this._animateLayoutUpdateNextFrame=!0))}const e=this._previousRect.size.width/this._rect.size.width,i=this._previousRect.size.height/this._rect.size.height;this._view.viewProps.borderRadius.applyScaleInverse(),this._setTarget(new k(e,i),!1),this._animateLayoutUpdateNextFrame=!0}else this._animateLayoutUpdateNextFrame&&(this._setTarget(this._initialValue,!0),this._animateLayoutUpdateNextFrame=!1)}get shouldRender(){if(!this._hasChanged)return!1;if(!this._previousRenderValue)return!0;const t=this.renderValue;return!($(t.x,this._previousRenderValue.x)&&$(t.y,this._previousRenderValue.y))}get renderValue(){const t=this._view._parent?this._view._parent.scale.x:1,e=this._view._parent?this._view._parent.scale.y:1,i=this._currentValue.x/t,s=this._currentValue.y/e;return new k(i,s)}projectStyles(){const t=this.renderValue,e=`scale3d(${t.x}, ${t.y}, 1)`;return this._previousRenderValue=t,e}isTransform(){return!0}}class Lt extends Pt{get width(){return this._view.rect.size.width}get height(){return this._view.rect.size.height}get localWidth(){return this._currentValue.x}get localHeight(){return this._currentValue.y}get widthAfterScale(){const t=this._view.scale.x;return this.localWidth*t}get heightAfterScale(){const t=this._view.scale.y;return this.localHeight*t}get initialWidth(){return this._initialValue.x}get initialHeight(){return this._initialValue.y}set(t,e=!0){const i={width:this._currentValue.x,height:this._currentValue.y,...t};this._setTarget(new k(i.width,i.height),e)}setWidth(t,e=!0){const i={width:this._currentValue.x,height:this._currentValue.y,width:t};this._setTarget(new k(i.width,i.height),e)}setHeight(t,e=!0){const i={width:this._currentValue.x,height:this._currentValue.y,height:t};this._setTarget(new k(i.width,i.height),e)}reset(t=!0){this._setTarget(new k(this.initialWidth,this.initialHeight),t)}update(t,e){this._targetValue.x===this._currentValue.x&&this._targetValue.y===this._currentValue.y||(this._currentValue=this._animator.update({animatorProp:this._animatorProp,current:this._currentValue,target:this._targetValue,initial:this._previousValue,ts:t,dt:e}))}get shouldRender(){if(!this._hasChanged)return!1;if(!this._previousRenderValue)return!0;const t=this.renderValue;return!($(t.x,this._previousRenderValue.x)&&$(t.y,this._previousRenderValue.y))}get renderValue(){return new k(this._currentValue.x,this._currentValue.y)}projectStyles(){const t=this.renderValue,e=`width: ${t.x}px; height: ${t.y}px;`;return this._previousRenderValue=t,e}isTransform(){return!1}}class It{constructor(t){v(this,"_props",new Map),this._props.set("position",new At(new wt,new k(0,0),t)),this._props.set("scale",new Ct(new wt,new k(1,1),t)),this._props.set("rotation",new Tt(new yt,0,t)),this._props.set("size",new Lt(new wt,new k(t.rect.size.width,t.rect.size.height),t)),this._props.set("opacity",new Rt(new yt,t.elementReader.opacity.value,t)),this._props.set("borderRadius",new Et(new ft,[t.elementReader.borderRadius.value.topLeft,t.elementReader.borderRadius.value.topRight,t.elementReader.borderRadius.value.bottomRight,t.elementReader.borderRadius.value.bottomLeft],t)),this._props.set("origin",new xt(new wt,t.elementReader.origin.value,t))}allProps(){return Array.from(this._props.values())}allPropNames(){return Array.from(this._props.keys())}getPropByName(t){return this._props.get(t)}get position(){return this._props.get("position")}get scale(){return this._props.get("scale")}get rotation(){return this._props.get("rotation")}get size(){return this._props.get("size")}get opacity(){return this._props.get("opacity")}get borderRadius(){return this._props.get("borderRadius")}get origin(){return this._props.get("origin")}}class St{constructor(t,e,i,s){v(this,"id"),v(this,"name"),v(this,"element"),v(this,"styles",{}),v(this,"_viewProps"),v(this,"_previousRect"),v(this,"_onAddCallbacks"),v(this,"_onRemoveCallback"),v(this,"_skipFirstRenderFrame"),v(this,"_layoutTransition"),v(this,"_registry"),v(this,"_layoutId"),v(this,"_elementReader"),v(this,"_viewParents"),v(this,"_temporaryView"),v(this,"_inverseEffect"),v(this,"_renderNextTick"),v(this,"_layoutOption"),v(this,"_elementObserver"),v(this,"_hasReadElement"),v(this,"_shouldReadRect"),v(this,"_readWithScroll"),v(this,"_externalUserStyles"),this._registry=i,this.id=I(),this.name=e,this.element=t,this.element.dataset.velViewId=this.id,this._elementReader=G(this),this._viewParents=this._getParents(),this._previousRect=this._elementReader.rect,this._viewProps=new It(this),this._skipFirstRenderFrame=!0,this._layoutId=s,this._layoutTransition=!1,this._temporaryView=!1,this.styles=J(this.styles,(()=>{this._renderNextTick=!0})),this._externalUserStyles=this._getExternalUserStyles(),this._renderNextTick=!1,this._layoutOption=this._getLayoutOption(),this._hasReadElement=!1,this._shouldReadRect=!1,this._readWithScroll=!1,this._elementObserver=new O(t),this._elementObserver.onChange((t=>{this._hasReadElement?this._shouldReadRect=!1:(this._externalUserStyles=this._getExternalUserStyles(),this._shouldReadRect=!0,this._readWithScroll=t)}))}destroy(){this._viewProps.allProps().forEach((t=>t.destroy())),this.element.removeAttribute("data-vel-view-id"),this.element.removeAttribute("data-vel-plugin-id"),this._renderNextTick=!0}get elementReader(){return this._elementReader}get layoutOption(){return this._layoutOption}_getLayoutOption(){return this.element.closest("[data-vel-layout-position]")?"position":this.element.closest("[data-vel-layout-size]")?"size":"all"}setElement(t){this.element=t,this._elementReader=G(this),this.element.dataset.velViewId=this.id,this._elementObserver.setElement(t),this._viewParents=this._getParents()}get layoutId(){return this._layoutId}get position(){return this._viewProps.position}get scale(){return this._viewProps.scale}get _children(){const t=this.element.querySelectorAll("*");return Array.from(t).map((t=>t.dataset.velViewId)).filter((t=>t&&"string"==typeof t)).map((t=>this._registry.getViewById(t))).filter((t=>!!t))}get _parent(){return this._parents[0]}get _parents(){return this._viewParents}_getParents(){var t;const e=[];let i=this.element.parentElement;if(!i)return e;for(i=i.closest("[data-vel-view-id]");i;){const s=i.dataset.velViewId;if(s){const t=this._registry.getViewById(s);t&&e.push(t)}i=null==(t=i.parentElement)?void 0:t.closest("[data-vel-view-id]")}return e}get rotation(){return this._viewProps.rotation}get size(){return this._viewProps.size}get _localWidth(){return this._viewProps.size.localWidth}get _localHeight(){return this._viewProps.size.localHeight}get opacity(){return this._viewProps.opacity}get borderRadius(){return this._viewProps.borderRadius}get origin(){return this._viewProps.origin}get data(){const t=this.element.dataset;return Object.keys(t).filter((t=>t.includes("velData"))).map((t=>t.replace("velData",""))).map((t=>`${t[0].toLowerCase()}${t.slice(1)}`)).reduce(((e,i)=>{const s=t[`velData${i[0].toUpperCase()}${i.slice(1)}`];return!e[i]&&s&&(e[i]=s),e}),{})}get onAddCallbacks(){return this._onAddCallbacks}get onRemoveCallback(){return this._onRemoveCallback}get isLayoutTransitionEnabled(){return this._layoutTransition}get hasLayoutTransitionEnabledForParents(){return this._parents.some((t=>t.isLayoutTransitionEnabled))}get isInverseEffectEnabled(){let t=!1;for(let e=0;e<this._parents.length;e++){const i=this._parents[e];if(typeof i._inverseEffect<"u"){t=i._inverseEffect;break}}return t}layoutTransition(t){this._layoutTransition=t,this.inverseEffect(t)}inverseEffect(t){this._inverseEffect=t,t&&this._children.forEach((t=>{if("instant"===t.position.animator.name){const e=this.viewProps.position.getAnimator();t.position.setAnimator(e.name,e.config)}if("instant"===t.scale.animator.name){const e=this.viewProps.scale.getAnimator();t.scale.setAnimator(e.name,e.config)}}))}setAnimatorsFromParent(){let t=this._parent;for(;t&&!t._inverseEffect;)t=t._parent;if(t){if("instant"===this.position.animator.name){const e=t.viewProps.position.getAnimator();this.position.setAnimator(e.name,e.config)}if("instant"===this.scale.animator.name){const e=t.viewProps.scale.getAnimator();this.scale.setAnimator(e.name,e.config)}}}get _isRemoved(){return!this._registry.getViewById(this.id)}setPluginId(t){this.element.dataset.velPluginId=t}hasElement(t){return this.element.contains(t)}getScroll(){return this._elementReader.scroll}intersects(t,e){const i=this.element.getBoundingClientRect(),s=i.left,r=i.top;return t>=s&&t<=s+i.width&&e>=r&&e<=r+i.height}overlapsWith(t){const e=t._localWidth*t.scale.x,i=t._localHeight*t.scale.y,s=this._localWidth*this.scale.x,r=this._localHeight*this.scale.y;return this.position.x<t.position.x+e&&this.position.x+s>t.position.x&&this.position.y<t.position.y+i&&this.position.y+r>t.position.y}distanceTo(t){const e=new k(this.position.x,this.position.y),i=new k(t.position.x,t.position.y);return k.sub(i,e).magnitude}read(){this._shouldReadRect&&(this._elementReader.update(this._readWithScroll),this._children.forEach((t=>{t.setHasReadElement(!0),t.elementReader.update(this._readWithScroll)})),this._shouldReadRect=!1,this._readWithScroll=!1),this.setHasReadElement(!1)}setHasReadElement(t){this._hasReadElement=t}get rect(){return this._elementReader.rect}get previousRect(){return this._previousRect}update(t,e){this._viewProps.allProps().forEach((i=>i.update(t,e)))}_updatePreviousRect(){this._previousRect=this._elementReader.rect}setAsTemporaryView(){this._temporaryView=!0}get isTemporaryView(){return this._temporaryView}get shouldRender(){return this._renderNextTick||this._viewProps.allProps().some((t=>t.shouldRender))}_cleanCssText(t){const e=new Map,i=/([-\w]+)\s*:\s*([^;]+)\s*;?/g;let s;for(;null!==(s=i.exec(t));){const[t,i,r]=s;if(!r.trim())continue;const n=i.replace(/^-\w+-/,"");(!e.has(n)||!i.startsWith("-"))&&e.set(n,`${n}: ${r.trim()}`)}return Array.from(e.values()).join("; ")}render(){if(!this.shouldRender)return;if(this._isRemoved&&this._skipFirstRenderFrame)return void(this._skipFirstRenderFrame=!1);let t="";const e=this._viewProps.allProps(),i=e.filter((t=>t.isTransform())),s=e.filter((t=>!t.isTransform()));if(i.some((t=>t.hasChanged()))){const e=i.reduce(((t,e,s)=>(t+=e.projectStyles(),s<i.length-1&&(t+=" "),s===i.length-1&&(t+=";"),t)),"transform: ");t+=e}s.forEach((e=>{e.hasChanged()&&(t+=e.projectStyles())})),t+=this._getUserStyles(),this._cleanCssText(this.element.style.cssText)!==this._cleanCssText(t)&&(this.element.style.cssText=t),this._renderNextTick=!1}_getExternalUserStyles(){const t=this.element.style.cssText,e=this.styles;if(0===t.length)return"";const i=["transform","transform-origin","opacity","width","height","border-radius"],s={};for(const r in e)e.hasOwnProperty(r)&&(s[P(r)]=e[r]);return t.split(";").map((t=>t.trim())).filter(Boolean).filter((t=>{const e=t.indexOf(":");if(-1===e)return!1;const r=t.slice(0,e).trim();return!s.hasOwnProperty(r)&&!i.includes(r)})).join("; ")}_getUserStyles(){return Object.keys(this.styles).reduce(((t,e)=>{if(!e)return t;return t+`${P(e).replace("webkit","-webkit").replace("moz","-moz")}: ${this.styles[e]}; `}),this._externalUserStyles)}markAsAdded(){delete this.element.dataset.velProcessing}onAdd(t){this._onAddCallbacks=t}onRemove(t){this._onRemoveCallback=t}get viewProps(){return this._viewProps}getPropByName(t){return this._viewProps.getPropByName(t)}_copyAnimatorsToAnotherView(t){t.viewProps.allPropNames().forEach((e=>{var i,s;const r=null==(i=this.viewProps.getPropByName(e))?void 0:i.getAnimator();r&&(null==(s=t.viewProps.getPropByName(e))||s.setAnimator(r.name,r.config))}))}getChildren(t){const e=this.element.querySelectorAll("*"),i=Array.from(e).filter((e=>{const i=e;return typeof i.dataset.velViewId<"u"&&i.dataset.velView===t})).map((t=>t.dataset.velViewId));return this._registry.getViewsById(i)}getChild(t){return this.getChildren(t)[0]}getParent(t){const e=this.element.closest(`[data-vel-view="${t}"]`);if(!e)return;const i=e.dataset.velViewId;return i?this._registry.getViewById(i):void 0}}class Nt{constructor(t,e){v(this,"_appEventBus"),v(this,"_eventBus"),v(this,"_plugins",[]),v(this,"_views",[]),v(this,"_viewsPerPlugin",new Map),v(this,"_viewsToBeCreated",[]),v(this,"_viewsToBeRemoved",[]),v(this,"_viewsCreatedInPreviousFrame",[]),v(this,"_layoutIdToViewMap",new Map),v(this,"_eventPluginsPerPlugin",new Map),v(this,"_pluginNameToPluginFactoryMap",new Map),v(this,"_pluginNameToPluginConfigMap",new Map),this._appEventBus=t,this._eventBus=e}update(){this._handleRemovedViews(),this._handleAddedViews()}associateEventPluginWithPlugin(t,e){let i=this._eventPluginsPerPlugin.get(t);i||(i=[],this._eventPluginsPerPlugin.set(t,i)),i.push(e)}_handleRemovedViews(){const t=this._viewsToBeRemoved.filter((t=>t.dataset.velViewId));t.length&&(t.forEach((t=>{const e=t.dataset.velViewId;e&&this._handleRemoveView(e)})),this._viewsToBeRemoved=[])}_getPluginNameForElement(t){const e=t.dataset.velPlugin;if(e&&e.length>0)return e;const i=t.closest("[data-vel-plugin]");return i?i.dataset.velPlugin:void 0}_getPluginIdForElement(t){const e=this._getPluginNameForElement(t);if(!e)return;const i=t.closest("[data-vel-plugin-id]");if(i)return i.dataset.velPluginId;const s=this.getPluginByName(e);return s?s.id:void 0}_isScopedElement(t){const e=this._getPluginNameForElement(t);if(!e)return!1;const i=this._pluginNameToPluginFactoryMap.get(e),s=null==i?void 0:i.scope;return t.dataset.velView===s}_removeElementsWithParent(t){const e=new Set(t);return t.filter((t=>{let i=t.parentElement;for(;i;){if(e.has(i))return!1;i=i.parentElement}return!0}))}_handleAddedViews(){this._viewsCreatedInPreviousFrame.forEach((t=>{t.markAsAdded()})),this._viewsCreatedInPreviousFrame=[];const t=this._removeElementsWithParent(this._viewsToBeCreated),e=Array.from(new Set(t.filter((t=>this._isScopedElement(t)&&!this._isElementIgnored(t))))),i=t.filter((t=>!this._isScopedElement(t)&&!this._isElementIgnored(t)));this._viewsToBeCreated=[],e.forEach((t=>{const e=this._getPluginNameForElement(t),i=this._pluginNameToPluginFactoryMap.get(e),s=this._pluginNameToPluginConfigMap.get(e),r=t.dataset.velPluginKey,n=F(i,this,this._eventBus,this._appEventBus,s,r);this._plugins.push(n);const a=t.dataset.velView,o=this._createNewView(t,a,n);o.isInverseEffectEnabled&&o.setAnimatorsFromParent(),n.notifyAboutViewAdded(o)}));const s=i.filter((t=>!!this._getPluginIdForElement(t)));0!==s.length&&s.forEach((t=>{const e=this._getPluginIdForElement(t),i=t.dataset.velView;if(!i||!e)return;const s=this._getPluginById(e);if(!s)return;const r=this._getLayoutIdForElement(t,s);let n;r&&this._layoutIdToViewMap.has(r)?(n=this._layoutIdToViewMap.get(r),n.setElement(t),n.setPluginId(s.id),this._createChildrenForView(n,s)):n=this._createNewView(t,i,s),n.isInverseEffectEnabled&&n.setAnimatorsFromParent(),s.notifyAboutViewAdded(n)}))}_getLayoutIdForElement(t,e){const i=t.dataset.velLayoutId;if(i)return`${i}-${e.id}`}_createNewView(t,e,i){const s=this._getLayoutIdForElement(t,i),r=this.createView(t,e,s);return i.addView(r),r.layoutId&&this._layoutIdToViewMap.set(r.layoutId,r),this._createChildrenForView(r,i),this._appEventBus.emitPluginReadyEvent(i.pluginName,i.api,!0),requestAnimationFrame((()=>{requestAnimationFrame((()=>{this._appEventBus.emitPluginReadyEvent(i.pluginName,i.api)}))})),r}_createChildrenForView(t,e){const i=t.element.querySelectorAll("*");if(i.length){if(Array.from(i).some((t=>this._getPluginNameForElement(t)!==e.pluginName)))return;Array.from(i).filter((t=>!this._isElementIgnored(t))).forEach((i=>{const s=i,r=s.dataset.velView?s.dataset.velView:`${t.name}-child`,n=this._getLayoutIdForElement(s,e),a=this.createView(s,r,n);n&&!this._layoutIdToViewMap.has(n)&&this._layoutIdToViewMap.set(n,a),e.addView(a),e.notifyAboutViewAdded(a)}))}}_handleRemoveView(t){this._plugins.forEach((e=>{if(!this._viewsPerPlugin.get(e.id))return;const i=this._getPluginViewById(e,t);i&&e.removeView(i)}))}removeViewById(t,e){this._unassignViewFromPlugin(t,e),this._views=this._views.filter((e=>e.id!==t))}_unassignViewFromPlugin(t,e){const i=this._viewsPerPlugin.get(e);if(!i)return;const s=i.indexOf(t);-1!==s&&i.splice(s,1)}getViewById(t){return this._views.find((e=>e.id===t))}getViewsById(t){return this._views.filter((e=>t.includes(e.id)))}_getPluginById(t){return this._plugins.find((e=>e.id===t))}_getPluginViewById(t,e){return this.getViewsForPlugin(t).find((t=>t.id===e))}destroy(t,e){if(!t)return void this._destroyAll(e);let i=[];if(t&&t.length>0){const e=this.getPluginByName(t);if(e){const t=(this._eventPluginsPerPlugin.get(e.id)||[]).map((t=>this._getPluginById(t))).filter((t=>typeof t<"u"));i.push(e),i.push(...t)}}else i=this._plugins;i.forEach((t=>{this._destroyPlugin(t)})),requestAnimationFrame((()=>{null==e||e()}))}_destroyPlugin(t){const e=this.getViewsForPlugin(t);e.forEach((t=>{t.layoutId&&this._layoutIdToViewMap.delete(t.layoutId),t.destroy()})),this._views=this._views.filter((t=>!e.find((e=>e.id===t.id)))),this._viewsPerPlugin.delete(t.id),this._plugins=this._plugins.filter((e=>e.id!==t.id))}_destroyAll(t){this._views.forEach((t=>t.destroy())),requestAnimationFrame((()=>{this._plugins=[],this._views=[],this._viewsPerPlugin.clear(),this._viewsToBeCreated=[],this._viewsToBeRemoved=[],this._viewsCreatedInPreviousFrame=[],this._layoutIdToViewMap.clear(),this._eventPluginsPerPlugin.clear(),null==t||t()}))}reset(t,e){let i=[];if(t&&t.length>0){const e=this.getPluginByName(t);if(e){const t=(this._eventPluginsPerPlugin.get(e.id)||[]).map((t=>this._getPluginById(t))).filter((t=>typeof t<"u"));i.push(e),i.push(...t)}}else i=this._plugins;requestAnimationFrame((()=>{i.forEach((t=>{this._resetPlugin(t)})),requestAnimationFrame((()=>{null==e||e()}))}))}_resetPlugin(t){const e=t.config,i=t.pluginFactory,s=t.internalBusEvent,r=!t.isRenderable(),n=this.getViewsForPlugin(t);n.forEach((t=>{t.layoutId&&this._layoutIdToViewMap.delete(t.layoutId),t.destroy()})),this._views=this._views.filter((t=>!n.find((e=>e.id===t.id)))),this._viewsPerPlugin.delete(t.id),this._plugins=this._plugins.filter((e=>e.id!==t.id)),r||requestAnimationFrame((()=>{this.createPlugin(i,this._eventBus,e).setInternalEventBus(s)}))}queueNodeToBeCreated(t){this._viewsToBeCreated.push(t)}queueNodeToBeRemoved(t){this._viewsToBeRemoved.push(t)}notifyPluginAboutDataChange(t){const e=this._plugins.filter((e=>e.id===t.pluginId));!e||!e.length||e.forEach((e=>{e.notifyAboutDataChanged({dataName:t.dataName,dataValue:t.dataValue,viewName:t.viewName})}))}getPlugins(){return this._plugins}getRenderablePlugins(){return this._plugins.filter((function(t){return t.isRenderable()}))}getPluginByName(t,e){return this._plugins.find((i=>e?i.pluginKey===e&&i.pluginName===t:i.pluginName===t))}getPluginsByName(t,e){return this._plugins.filter((i=>e?i.pluginKey===e&&i.pluginName===t:i.pluginName===t))}hasPlugin(t){return!!t.pluginName&&!!this.getPluginByName(t.pluginName)}createPlugin(t,e,i={},s=!1){if(!t.pluginName)throw Error(`Plugin ${t.name} must contain a pluginName field`);let r=[];if(t.scope){const e=s?`[data-vel-plugin=${t.pluginName}][data-vel-view=${t.scope}]:not([data-vel-plugin-id])`:`[data-vel-plugin=${t.pluginName}][data-vel-view=${t.scope}]`,n=document.querySelectorAll(e);this._pluginNameToPluginFactoryMap.has(t.pluginName)||this._pluginNameToPluginFactoryMap.set(t.pluginName,t),this._pluginNameToPluginConfigMap.has(t.pluginName)||this._pluginNameToPluginConfigMap.set(t.pluginName,i),r=n?Array.from(n):[document.documentElement]}else r=[document.documentElement];const n=r.map((s=>{const r=s.dataset.velPluginKey,n=F(t,this,e,this._appEventBus,i,r);this._plugins.push(n);let a=[];s!==document.documentElement&&a.push(s);const o=s.querySelectorAll(`[data-vel-plugin=${n.pluginName}]`);a=[...a,...o];const l=a.filter((t=>{if(this._isElementIgnored(t))return!1;if(!t.parentElement)return!0;const e=this._getPluginNameForElement(t.parentElement);return!(e&&e.length>0)}));return l.length&&l.forEach((t=>{const e=t.dataset.velView;if(!e)return;const i=this._createNewView(t,e,n);n.notifyAboutViewAdded(i)})),n}));if(n&&n.length>0)return n[0];const a=F(t,this,e,this._appEventBus,i);return t.scope,a}updatePlugin(t,e,i={}){return this.createPlugin(t,e,i,!0)}getViews(){return this._views}createView(t,e,i){const s=new St(t,e,this,i);return this._views.push(s),this._viewsCreatedInPreviousFrame.push(s),s}_isElementIgnored(t){return t.closest("[data-vel-ignore]")}assignViewToPlugin(t,e){this._viewsPerPlugin.has(e.id)||this._viewsPerPlugin.set(e.id,[]);const i=this._viewsPerPlugin.get(e.id);i.includes(t.id)||i.push(t.id)}getViewsForPlugin(t){const e=this._viewsPerPlugin.get(t.id);return e?e.map((t=>this._views.find((e=>e.id===t)))).filter((t=>!!t)):[]}getViewsByNameForPlugin(t,e){return this.getViewsForPlugin(t).filter((t=>t.name===e))}}class Mt{constructor(t){v(this,"pluginApi"),this.pluginApi=t.pluginApi}}class Bt{constructor(t){v(this,"pluginApi"),this.pluginApi=t.pluginApi}}class Ft{constructor(){v(this,"previousTime",0),v(this,"registry"),v(this,"eventBus"),v(this,"appEventBus"),this.eventBus=new C,this.appEventBus=new C,this.registry=new Nt(this.appEventBus,this.eventBus),new x(this.eventBus)}static create(){return new Ft}addPlugin(t,e={}){this.registry.hasPlugin(t)||this.registry.createPlugin(t,this.eventBus,e)}updatePlugin(t,e={}){this.registry.hasPlugin(t)&&this.registry.updatePlugin(t,this.eventBus,e)}reset(t,e){this.registry.reset(t,e)}destroy(t,e){this.registry.destroy(t,e)}getPlugin(t,e){let i="string"==typeof t?t:t.pluginName;const s=this.registry.getPluginByName(i,e);if(!s)throw new Error(`You can't call getPlugin for ${i} with key: ${e} because it does not exist in your app`);return s.api}getPlugins(t,e){let i="string"==typeof t?t:t.pluginName;const s=this.registry.getPluginsByName(i,e);if(0===s.length)throw new Error(`You can't call getPlugins for ${i} with key: ${e} because they don't exist in your app`);return s.map((t=>t.api))}onPluginEvent(t,e,i,s){requestAnimationFrame((()=>{const r=this.registry.getPluginByName(t.pluginName,s);r&&r.on(e,i)}))}removePluginEventListener(t,e,i){const s=this.registry.getPluginByName(t.pluginName);s&&s.removeListener(e,i)}run(){"loading"===document.readyState?document.addEventListener("DOMContentLoaded",this.start.bind(this)):this.start()}start(){this.setup(),requestAnimationFrame(this.tick.bind(this))}setup(){this.listenToNativeEvents(),this.subscribeToEvents()}listenToNativeEvents(){document.addEventListener("click",(t=>{this.eventBus.emitEvent(w,{x:t.clientX,y:t.clientY,target:t.target})})),document.addEventListener("pointermove",(t=>{this.eventBus.emitEvent(f,{x:t.clientX,y:t.clientY,target:t.target})})),document.addEventListener("pointerdown",(t=>{this.eventBus.emitEvent(y,{x:t.clientX,y:t.clientY,target:t.target})})),document.addEventListener("pointerup",(t=>{this.eventBus.emitEvent(V,{x:t.clientX,y:t.clientY,target:t.target})}))}tick(t){let e=(t-this.previousTime)/1e3;e>.016&&(e=1/60),this.previousTime=t,this.eventBus.reset(),this.subscribeToEvents(),this.read(),this.update(t,e),this.render(),requestAnimationFrame(this.tick.bind(this))}subscribeToEvents(){this.eventBus.subscribeToEvent(E,this.onNodeAdded.bind(this)),this.eventBus.subscribeToEvent(R,this.onNodeRemoved.bind(this)),this.eventBus.subscribeToEvent(b,this.onDataChanged.bind(this)),this.registry.getPlugins().forEach((t=>{t.subscribeToEvents(this.eventBus)}))}onNodeAdded({node:t}){this.registry.queueNodeToBeCreated(t)}onNodeRemoved({node:t}){this.registry.queueNodeToBeRemoved(t)}onDataChanged(t){this.registry.notifyPluginAboutDataChange(t)}read(){this.registry.getViews().forEach((t=>{t.read()}))}update(t,e){this.registry.update(),this.registry.getPlugins().slice().reverse().forEach((t=>{t.init()})),this.registry.getRenderablePlugins().forEach((i=>{i.update(t,e)})),this.registry.getViews().forEach((i=>{i.update(t,e)})),this.registry.getViews().forEach((t=>{t._updatePreviousRect()}))}render(){this.registry.getRenderablePlugins().forEach((t=>{t.render()})),this.registry.getViews().forEach((t=>{t.render()}))}}class kt{constructor(t){v(this,"view"),v(this,"previousX"),v(this,"previousY"),v(this,"x"),v(this,"y"),v(this,"pointerX"),v(this,"pointerY"),v(this,"isDragging"),v(this,"target"),v(this,"directions",[]),v(this,"width"),v(this,"height"),v(this,"distance"),v(this,"stopped"),this.props=t,this.previousX=t.previousX,this.previousY=t.previousY,this.x=t.x,this.y=t.y,this.pointerX=t.pointerX,this.pointerY=t.pointerY,this.width=t.width,this.height=t.height,this.distance=t.distance,this.view=t.view,this.isDragging=t.isDragging,this.stopped=t.stopped,this.target=t.target,this.directions=t.directions}}class Ot extends M{constructor(){super(...arguments),v(this,"_pointerX",0),v(this,"_pointerY",0),v(this,"_initialPointer",new k(0,0)),v(this,"_initialPointerPerView",new Map),v(this,"_pointerDownPerView",new Map),v(this,"_viewPointerPositionLog",new Map),v(this,"_stopTimer",0)}setup(){document.addEventListener("selectstart",this.onSelect.bind(this))}onSelect(t){this._isDragging&&t.preventDefault()}get _isDragging(){return Array.from(this._pointerDownPerView.values()).some((t=>!!t))}subscribeToEvents(t){t.subscribeToEvent(y,(({x:t,y:e})=>{this._initialPointer=new k(t,e),this.getViews().forEach((i=>{this._pointerDownPerView.set(i.id,i.intersects(t,e));const s=i.isLayoutTransitionEnabled?i.position.initialX:i.position.x,r=i.isLayoutTransitionEnabled?i.position.initialY:i.position.y,n=new k(t-s,e-r);this._pointerX=t,this._pointerY=e,this._initialPointerPerView.set(i.id,n)}))})),t.subscribeToEvent(V,(()=>{this.getViews().forEach((t=>{this._pointerDownPerView.get(t.id)&&this._initialPointerPerView.get(t.id)&&(this._pointerDownPerView.set(t.id,!1),this._emitEvent(t,[]))}))})),t.subscribeToEvent(f,(({x:t,y:e})=>{this._pointerX=t,this._pointerY=e,this.getViews().forEach((i=>{if(this._pointerDownPerView.get(i.id)&&this._initialPointerPerView.get(i.id)){this._viewPointerPositionLog.has(i.id)||this._viewPointerPositionLog.set(i.id,[]);const s=new k(t,e),r=this._viewPointerPositionLog.get(i.id);r&&r.push(new k(t,e));const n=r&&r.length>=2?r[r.length-2]:s.clone(),a=this._calculateDirections(n,s);this._emitEvent(i,a),clearTimeout(this._stopTimer),this._stopTimer=setTimeout((()=>{!0===this._pointerDownPerView.get(i.id)&&this._emitEvent(i,a,!0)}),120)}}))}))}_emitEvent(t,e,i=!1){const s=this._viewPointerPositionLog.get(t.id),r=s&&s.length>=2?s[s.length-2]:null,n=this._pointerX-this._initialPointerPerView.get(t.id).x,a=this._pointerY-this._initialPointerPerView.get(t.id).y,o=this._pointerX,l=this._pointerY,h=r?r.x-this._initialPointerPerView.get(t.id).x:n,u=r?r.y-this._initialPointerPerView.get(t.id).y:a,c=this._pointerY-this._initialPointer.y,d=this._pointerX-this._initialPointer.x,p=function(t,e){const i=e.x-t.x,s=e.y-t.y;return Math.sqrt(i*i+s*s)}(this._initialPointer,{x:this._pointerX,y:this._pointerY}),_=!0===this._pointerDownPerView.get(t.id);_||this._viewPointerPositionLog.clear();const g={view:t,target:t.element,previousX:h,previousY:u,x:n,y:a,pointerX:o,pointerY:l,distance:p,width:d,height:c,isDragging:_,directions:e,stopped:i};this.emit(kt,g)}_calculateDirections(t,e){const i={up:k.sub(new k(t.x,t.y-1),t),down:k.sub(new k(t.x,t.y+1),t),left:k.sub(new k(t.x-1,t.y),t),right:k.sub(new k(t.x+1,t.y),t)},s=k.sub(e,t).unitVector;return[{direction:"up",projection:s.dot(i.up)},{direction:"down",projection:s.dot(i.down)},{direction:"left",projection:s.dot(i.left)},{direction:"right",projection:s.dot(i.right)}].filter((t=>t.projection>0)).map((t=>t.direction))}}v(Ot,"pluginName","DragEventPlugin");class $t{constructor(t){v(this,"view"),v(this,"direction"),this.props=t,this.view=t.view,this.direction=t.direction}}v(class extends M{constructor(){super(...arguments),v(this,"_viewIsPointerDownMap",new Map),v(this,"_viewPointerPositionLog",new Map),v(this,"_targetPerView",new Map)}subscribeToEvents(t){t.subscribeToEvent(y,(({x:t,y:e,target:i})=>{this.getViews().forEach((s=>{this._targetPerView.set(s.id,i),s.intersects(t,e)&&this._viewIsPointerDownMap.set(s.id,!0)}))})),t.subscribeToEvent(f,(({x:t,y:e})=>{this.getViews().forEach((i=>{this._viewIsPointerDownMap.get(i.id)&&(this._viewPointerPositionLog.has(i.id)||this._viewPointerPositionLog.set(i.id,[]),this._viewPointerPositionLog.get(i.id).push(new k(t,e)))}))})),t.subscribeToEvent(V,(({x:t,y:e})=>{this.getViews().forEach((i=>{if(!this._viewIsPointerDownMap.get(i.id)||!this._viewPointerPositionLog.has(i.id))return;const s=new k(t,e),r=this._viewPointerPositionLog.get(i.id),n=r[r.length-2]||s.clone(),a=this._targetPerView.get(i.id),o=function(t,e){const i={up:k.sub(new k(t.x,t.y-1),t),down:k.sub(new k(t.x,t.y+1),t),left:k.sub(new k(t.x-1,t.y),t),right:k.sub(new k(t.x+1,t.y),t)},s=k.sub(e,t).unitVector,r=["up","down","left","right"],n=[s.dot(i.up),s.dot(i.down),s.dot(i.left),s.dot(i.right)],a=Math.max(...n),o=n.indexOf(a),l=r[o],h=k.sub(e,t).magnitude;return{hasSwiped:s.dot(i[l])*h>30,direction:l}}(n,s);a&&i.hasElement(a)&&o.hasSwiped&&this.emit($t,{view:i,direction:o.direction}),this._viewPointerPositionLog.set(i.id,[]),this._viewIsPointerDownMap.set(i.id,!1)}))}))}},"pluginName","SwipeEventPlugin");class zt{constructor(t){v(this,"view"),this.props=t,this.view=t.view}}v(class extends M{subscribeToEvents(t){t.subscribeToEvent(w,(({x:t,y:e,target:i})=>{this.getViews().forEach((s=>{const r=i,n=s.element===r||s.element.contains(r);s.intersects(t,e)&&n&&this.emit(zt,{view:s})}))}))}},"pluginName","ClickEventPlugin");class Dt{constructor(t){d(this,"data"),this.data=t.data}}class Wt{constructor(t){d(this,"data"),this.data=t.data}}class qt{}class Ut{constructor(t){d(this,"data"),this.data=t.data}}function jt(t){return{map:new Map(t),array:Array.from(t).map((([t,e])=>({slotId:t,itemId:e}))),object:Array.from(t).reduce(((t,[e,i])=>(t[e]=i,t)),{})}}const Yt=t=>{const e=t.useEventPlugin(Ot);e.on(kt,(function(e){if(!f)return;const i=b().swapMode;n="handle"===e.view.name?e.view.getParent("item"):e.view,_||(_=n.getParent("slot")),null===m&&null===w&&(m=e.view.position.x-n.position.x,w=e.view.position.y-n.position.y);const P=s.some((t=>t.intersects(e.pointerX,e.pointerY)));e.isDragging?(y||(y=!0,t.emit(qt,{})),u=e,A(),s.forEach((s=>{var r;if(!s.intersects(e.pointerX,e.pointerY))return void(s!==_&&s.element.removeAttribute("data-swapy-highlighted"));if(typeof s.element.dataset.swapyHighlighted>"u"&&(s.element.dataset.swapyHighlighted=""),!_||("stop"===i||"drop"!==i&&!c)&&!e.stopped)return;const a=s.element.dataset.swapySlot,o=null==(r=s.getChild("item"))?void 0:r.element.dataset.swapyItem,l=_.element.dataset.swapySlot,h=n.element.dataset.swapyItem;if(!a||!l||!h)return;const u=new Map(g);u.set(a,h),o?u.set(l,o):u.set(l,null),p(u,v)||(V=E(new Map(u)),!d&&"drop"!==i&&V(),_=null,"drop"!==i&&t.emit(Dt,{data:jt(u)}))})),r.forEach((t=>{t.styles.zIndex=t===n?"2":""}))):(s.forEach((t=>{t.element.removeAttribute("data-swapy-highlighted")})),n.position.reset(),_=null,a=null,o=null,l=null,h=null,u=null,m=null,w=null,y=!1,"drop"===i&&(P||(V=E(new Map(g))),V(),t.emit(Dt,{data:jt(g)})),V=()=>{},t.emit(Wt,{data:jt(g)})),requestAnimationFrame((()=>{A()}))}));let i,s,r,n,a,o,l,h,u,c,d,_,g=new Map,v=new Map,m=null,w=null,f=!0,y=!1,V=()=>{};function b(){return{animation:i.data.configAnimation,continuousMode:typeof i.data.configContinuousMode<"u",manualSwap:typeof i.data.configManualSwap<"u",swapMode:i.data.configSwapMode}}function P(){const t=b().animation;return"dynamic"===t?{animator:"dynamic",config:{}}:"spring"===t?{animator:"spring",config:{damping:.7,stiffness:.62}}:{animator:"instant",config:{}}}function E(t){return()=>{g=t,v=new Map(g)}}function R(t){const i=t.getChild("item");i&&function(t){const i=P();t.styles.position="relative",t.styles.userSelect="none",t.styles.webkitUserSelect="none",t.position.setAnimator(i.animator,i.config),t.scale.setAnimator(i.animator,i.config),t.layoutTransition(!0),requestAnimationFrame((()=>{const i=t.getChild("handle");i?(e.addView(i),i.styles.touchAction="none"):(e.addView(t),t.styles.touchAction="none")}))}(i),g.set(t.element.dataset.swapySlot,i?i.element.dataset.swapyItem:null)}function x(){const e=P();t.getViews("root-child").forEach((t=>{t.position.setAnimator(e.animator,e.config),t.scale.setAnimator(e.animator,e.config),t.layoutTransition(!0)}))}function A(){if(!u)return;if(!a||!o){const t=n.getScroll();a=u.pointerX-n.position.x+t.x,o=u.pointerY-n.position.y+t.y}(!l||!h)&&(l=n.size.width,h=n.size.height);const t=n.size.width/l,e=n.size.height/h,i=a*(t-1),s=o*(e-1);n.position.set({x:u.x-i-(m||0),y:u.y-s-(w||0)},1!==n.scale.x||1!==n.scale.y)}t.api({setEnabled(t){f=t},setData(t){const e=function(t){if(t.map)return{map:new Map(t.map),array:Array.from(t.map).map((([t,e])=>({slotId:t,itemId:e}))),object:Array.from(t.map).reduce(((t,[e,i])=>(t[e]=i,t)),{})};if(t.object){const e={...t.object};return{map:new Map(Object.entries(e)),array:Object.entries(e).map((([t,e])=>({slotId:t,itemId:e}))),object:e}}{const e=[...t.array];return{map:new Map(e.map((({slotId:t,itemId:e})=>[t,e]))),array:e,object:e.reduce(((t,{slotId:e,itemId:i})=>(t[e]=i,t)),{})}}}(t);g=new Map(e.map),v=new Map(g)}}),t.setup((()=>{i=t.getView("root"),s=t.getViews("slot"),r=t.getViews("item"),c=b().continuousMode,d=b().manualSwap,s.forEach((t=>{R(t)})),x(),v=new Map(g),requestAnimationFrame((()=>{t.emit(Ut,{data:jt(g)})}))})),t.onViewAdded((e=>{if(t.initialized)if("item"===e.name){r=t.getViews("item");R(e.getParent("slot")),x(),v=new Map(g),t.emit(Dt,{data:jt(g)})}else"slot"===e.name&&(s=t.getViews("slot"))}))};let Ht;function Xt(){return Ht?(Ht.updatePlugin(Yt),Ht):(Ht=Ft.create(),Ht.addPlugin(Yt),Ht.run(),Ht)}Yt.pluginName="Swapy",Yt.scope="root";const Kt={animation:"dynamic",continuousMode:!0,manualSwap:!1,swapMode:"hover"};function Zt(t,e={}){const i=_+++"";return t.dataset.velPluginKey=i,t.dataset.velPlugin="Swapy",t.dataset.velView="root",t.dataset.velDataConfigAnimation=e.animation,t.dataset.velDataConfigSwapMode=e.swapMode,e.continuousMode&&(t.dataset.velDataConfigContinuousMode="true"),e.manualSwap&&(t.dataset.velDataConfigManualSwap="true"),Array.from(t.querySelectorAll("[data-swapy-slot]")).forEach((t=>{t.dataset.velView="slot"})),Array.from(t.querySelectorAll("[data-swapy-item]")).forEach((t=>{t.dataset.velView="item",t.dataset.velLayoutId=t.dataset.swapyItem;const e=t.querySelector("[data-swapy-handle]");e&&(e.dataset.velView="handle")})),Array.from(t.querySelectorAll("[data-swapy-text]")).forEach((t=>{t.dataset.velLayoutPosition=""})),Array.from(t.querySelectorAll("[data-swapy-exclude]")).forEach((t=>{t.dataset.velIgnore=""})),i}function Gt(t,e={}){if(!t)throw new Error("Cannot create a Swapy instance because the element you provided does not exist on the page!");const i={...Kt,...e},s=t;if(!function(t){let e=!0;const i=t.querySelectorAll("[data-swapy-slot]");return 0===i.length&&(e=!1),i.forEach((t=>{const i=t,s=i.dataset.swapySlot;(!s||0===s.length)&&(e=!1);const r=i.children;r.length>1&&(e=!1);const n=r[0];n&&(!n.dataset.swapyItem||0===n.dataset.swapyItem.length)&&(e=!1)})),e}(s))throw new Error("Cannot create a Swapy instance because your HTML structure is invalid. Fix all above errors and then try!");const r=Zt(s,i),n=new Jt(s,r,i);return{onSwap(t){n.setSwapCallback(t)},onSwapEnd(t){n.setSwapEndCallback(t)},onSwapStart(t){n.setSwapStartCallback(t)},enable(t){n.setEnabled(t)},destroy(){n.destroy()},setData(t){n.setData(t)}}}class Jt{constructor(t,e,i){d(this,"_rootEl"),d(this,"_veloxiApp"),d(this,"_slotElMap"),d(this,"_itemElMap"),d(this,"_swapCallback"),d(this,"_swapEndCallback"),d(this,"_swapStartCallback"),d(this,"_previousMap"),d(this,"_pluginKey"),this._rootEl=t,this._veloxiApp=Xt(),this._slotElMap=this._createSlotElMap(),this._itemElMap=this._createItemElMap(),this._pluginKey=e,this._veloxiApp.onPluginEvent(Yt,Ut,(({data:t})=>{this._previousMap=t.map}),e),this._veloxiApp.onPluginEvent(Yt,Dt,(t=>{var e;this._previousMap&&p(this._previousMap,t.data.map)||(i.manualSwap||this._applyOrder(t.data.map),this._previousMap=t.data.map,null==(e=this._swapCallback)||e.call(this,t))}),e),this._veloxiApp.onPluginEvent(Yt,Wt,(t=>{var e;null==(e=this._swapEndCallback)||e.call(this,t)}),e),this._veloxiApp.onPluginEvent(Yt,qt,(()=>{var t;null==(t=this._swapStartCallback)||t.call(this)}),e),this.setupMutationObserver()}setupMutationObserver(){new MutationObserver((t=>{t.some((t=>"childList"===t.type))&&function(t){const e=Array.from(t.querySelectorAll("[data-swapy-slot]:not([data-vel-view])"));e.forEach((t=>{t.dataset.velView="slot"}));const i=Array.from(t.querySelectorAll("[data-swapy-item]:not([data-vel-view]"));return i.forEach((t=>{t.dataset.velView="item",t.dataset.velLayoutId=t.dataset.swapyItem;const e=t.querySelector("[data-swapy-handle]");e&&(e.dataset.velView="handle"),Array.from(t.querySelectorAll("[data-swapy-text]")).forEach((t=>{t.dataset.velLayoutPosition=""})),Array.from(t.querySelectorAll("[data-swapy-exclude]")).forEach((t=>{t.dataset.velIgnore=""}))})),i.length>0||e.length>0}(this._rootEl)&&(this._slotElMap=this._createSlotElMap(),this._itemElMap=this._createItemElMap())})).observe(this._rootEl,{childList:!0,subtree:!0})}setData(t){try{this._veloxiApp.getPlugin("Swapy",this._pluginKey).setData(t)}catch{}}destroy(){this._veloxiApp.destroy("Swapy")}setEnabled(t){try{this._veloxiApp.getPlugin("Swapy",this._pluginKey).setEnabled(t)}catch{}}setSwapCallback(t){this._swapCallback=t}setSwapEndCallback(t){this._swapEndCallback=t}setSwapStartCallback(t){this._swapStartCallback=t}_applyOrder(t){Array.from(t.keys()).forEach((e=>{var i;if(t.get(e)===(null==(i=this._previousMap)?void 0:i.get(e)))return;const s=t.get(e);if(!s)return;const r=this._slotElMap.get(e),n=this._itemElMap.get(s);!r||!n||(r.innerHTML="",r.appendChild(n))}))}_createSlotElMap(){return Array.from(this._rootEl.querySelectorAll("[data-swapy-slot]")).reduce(((t,e)=>(t.set(e.dataset.swapySlot,e),t)),new Map)}_createItemElMap(){return Array.from(this._rootEl.querySelectorAll("[data-swapy-item]")).reduce(((t,e)=>(t.set(e.dataset.swapyItem,e),t)),new Map)}}export{Gt as K,h as j,u};
